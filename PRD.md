# 📋 发票提取与管理应用程序 PRD

## 🚀 电梯游说

一款基于AI的智能发票管理系统，专为为澳洲繁忙的小企业主和会计师设计。用户只需上传PDF或图片，系统即可自动提取发票信息、智能分类、异常检测，并提供灵活的数据分析和导出功能。作为税务管理生态系统的第一阶段，为未来的税务计算和申报功能奠定坚实基础。

## 👥 目标用户

### 主要用户群体
- **澳洲纳税人** 🇦🇺：包括持有ABN的个人、合伙企业、公司等，需要符合澳洲税务局(ATO)要求的GST申报和税务抵扣管理
- **小企业主** 📊：需要高效管理日常发票，确保GST计算准确，为BAS申报和年度税务申报做准备
- **会计师/财务人员** 💼：需要批量处理多个客户的发票数据，确保符合澳洲会计准则和税法要求
- **自由职业者** 🎯：需要整理业务相关的发票和支出，最大化税务抵扣效益

### 用户特点
- 时间紧张，需要自动化解决方案
- 对数据准确性要求高
- 需要灵活的数据分析和报告功能
- 对用户体验敏感，喜欢现代化界面

## ⚡ 功能需求

### 1. 🔐 用户管理系统
- **多用户支持**：注册、登录、用户资料管理
- **邮件验证**：注册时邮箱验证、密码重置邮件
- **通知系统**：发票处理完成通知、异常检测警报邮件
- **角色权限**：
  - 👤 普通用户：管理自己的发票
  - 👨‍💼 会计师：管理多个客户账户
  - 🔑 管理员：系统管理和用户管理

### 2. 📤 发票上传与识别
- **文件上传**：支持PDF、JPG、PNG格式
- **双存储架构**：AWS S3永久存储（7年合规归档）+ OpenAI临时处理
- **合规性存储**：符合澳洲税务局(ATO)要求的7年发票保存义务
- **AI图像识别**：使用OpenAI Vision API提取发票信息
- **自动文件清理**：AI处理完成后自动删除OpenAI临时文件
- **结构化输出**：确保数据格式一致性
- **手动创建发票**：支持用户手动输入发票信息创建记录
- **后补文件上传**：允许为已存在的发票记录补充上传文件
- **智能数据合并**：AI提取的数据与手动输入数据智能合并更新

### 3. 🏷️ 智能发票分类系统
- **预设分类**：
  - 🏢 办公用品与设备
  - ✈️ 差旅与交通费
  - 🍽️ 招待费用
  - 💻 软件与技术服务
  - 🏠 租金与物业费
  - ⚡ 水电气费用
  - 📞 通讯费用
  - 🛠️ 维修与保养
  - 📚 培训与教育
  - 💰 金融服务费
  - 🎨 营销与广告
  - ⚖️ 法律与咨询费
- **自定义分类**：用户可创建个性化分类
- **AI智能建议**：基于历史数据自动推荐分类

### 4. 🤖 AI辅助验证与异常检测
- **数据验证**：
  - ✅ 发票号码格式检查
  - 🧮 金额计算验证（单价×数量=总价）
  - 📊 GST计算准确性检查（澳洲10%标准税率）
  - 🏢 ABN格式验证（澳洲商业号码11位数字）
- **异常检测**：
  - 🔄 重复发票识别
  - 💸 异常金额警报
  - 📅 日期异常提醒
  - 🏭 供应商信息一致性检查
- **智能建议**：
  - 🎯 自动分类推荐（基于澳洲税务抵扣规则）
  - 💡 税务抵扣项目识别（符合ATO指引）
  - ⚠️ 限制抵扣提醒（如商务餐饮50%限制）
  - ⏰ 付款期限提醒

### 5. 📊 发票管理与展示
- **发票列表**：
  - 🔍 多维度筛选（日期、金额、分类、供应商）
  - 🔢 灵活排序（按日期、金额、上传时间等）
  - 📈 分组统计（按月份、季度、财年、分类）
- **详细视图**：
  - 📄 发票详细信息显示
  - 🖼️ 原始PDF/图片预览
  - ✏️ 手动编辑功能
  - 🗑️ 删除功能

### 6. 📈 数据分析与报告
- **统计面板**：
  - 💰 总支出统计（按澳洲财年7月-6月计算）
  - 📊 分类占比分析（基于澳洲税务抵扣分类）
  - 📅 时间趋势图表（财年、季度、月度视图）
  - 🏢 供应商分析（包含ABN验证状态）
- **导出功能**：
  - 📋 Excel格式导出
  - 📄 CSV格式导出
  - 🎯 自定义导出字段

### 7. 🎨 用户界面功能
- **Shadcn UI组件库**：现代化、一致的用户界面
- **明暗主题切换**：支持用户偏好设置
- **国际化支持**：中文/英文语言切换
- **响应式设计**：完美适配桌面和移动设备

### 8. 🔧 技术架构
- **前端**：Next.js 15 + TypeScript + Tailwind CSS
- **UI库**：Shadcn UI + Lucide图标
- **状态管理**：Zustand
- **表单处理**：React Hook Form + Zod验证
- **后端**：Next.js API Routes
- **数据库**：PostgreSQL + Drizzle ORM
- **文件存储**：AWS S3 (Sydney region) + OpenAI Files API (临时)
- **数据主权**：所有文件存储在澳洲AWS区域，确保数据不出境
- **合规归档**：7年自动归档管理，符合ATO税务记录保存要求
- **AI服务**：OpenAI GPT-4 Vision
- **邮件服务**：Nodemailer (用户验证、发票处理通知、异常警报)
- **部署**：Vercel

📁 **项目结构详情**：请参考 [STRUCT.md](./STRUCT.md) 了解详细的架构设计和文件组织

## 📖 用户故事

### 👤 作为小企业主
- **上传发票**：我希望能够快速上传发票照片，系统自动提取所有关键信息
- **安全存储**：我希望所有发票文件都安全地存储在澳洲境内，满足ATO要求
- **长期保存**：我希望系统自动保存发票7年，无需担心合规问题
- **手动创建发票**：我希望能够手动创建发票记录，特别是当发票丢失或损坏时
- **后补文件上传**：我希望能够为已创建的发票记录后续补充上传文件
- **查看统计**：我希望能够一目了然地看到我的月度、季度支出统计
- **导出数据**：我希望能够导出Excel文件给我的会计师
- **分类管理**：我希望系统能够智能地对我的发票进行分类

### 👨‍💼 作为会计师
- **批量处理**：我希望能够高效地处理多个客户的发票数据
- **异常检测**：我希望系统能够自动发现可疑或异常的发票
- **灵活查询**：我希望能够按照不同维度筛选和分析发票数据
- **准确性验证**：我希望系统能够验证发票数据的准确性

### 🎯 作为自由职业者
- **简单易用**：我希望界面简洁直观，无需复杂的设置
- **移动友好**：我希望能够在手机上也能方便地上传和查看发票
- **分类提醒**：我希望系统能够提醒我哪些发票可以用于税务抵扣

## 🎨 UI设计指南

### 🎭 设计原则
- **简洁现代**：采用Shadcn UI的设计语言，界面简洁优雅
- **功能优先**：确保核心功能的易用性和可达性
- **渐进式披露**：复杂功能分层展示，避免界面拥挤
- **一致性**：保持整个应用的视觉和交互一致性

### 🎯 核心页面结构
1. **📊 仪表板页面**：
   - 快速统计卡片
   - 最近上传的发票
   - 图表和趋势分析
   
2. **📤 上传页面**：
   - 拖拽上传区域
   - 上传进度指示器
   - 实时识别结果展示
   - 手动创建发票表单
   - 智能数据合并界面
   
3. **📋 发票列表页面**：
   - 高级筛选器
   - 数据表格（支持排序、分页）
   - 批量操作功能
   
4. **📄 发票详情页面**：
   - 发票信息展示
   - 原始文件预览
   - 编辑和删除操作
   
5. **⚙️ 设置页面**：
   - 用户资料管理
   - 主题和语言设置
   - 分类管理

### 🌈 主题和样式
- **明暗主题**：支持系统主题检测和手动切换
- **色彩系统**：遵循Shadcn UI的色彩规范
- **动画效果**：利用Shadcn UI的过渡动画提升用户体验
- **响应式布局**：确保在各种设备上的最佳显示效果

### 🌍 国际化设计
- **语言切换**：右上角提供中英文切换按钮
- **RTL支持**：为未来支持更多语言做准备
- **本地化内容**：确保日期、数字格式符合当地习惯

### 😊 愉悦化用户体验设计
> 让税务管理不再紧张压抑，通过温暖友好的设计让用户感到轻松愉快

#### ✨ 成功反馈与庆祝
- **上传成功动画**：
  - 彩色纸屑飘落动画效果
  - "太棒了！发票已成功识别" + 绿色勾选动画
  - 小火箭🚀或小星星⭐动画效果
- **里程碑庆祝**：
  - "恭喜！这是您的第10张发票！"
  - "哇！本月已处理20张发票，效率超高！"
  - 成就徽章系统（处理发票数量、连续使用天数等）

#### 🌈 情感化界面元素
- **友好的空状态**：
  - "这里还很安静...上传第一张发票开始您的财务管理之旅吧！"
  - 可爱的插图和友好提示文案
  - "您的发票小助手正在待命中..."
- **鼓励性进度提示**：
  - "您离月度目标又近了一步！"
  - "坚持记录，财务管理越来越轻松！"
  - 进度条使用彩虹色彩而非单调灰色

#### 🤗 温暖的错误处理
- **友好的错误信息**：
  - "哎呀，这张图片有点模糊呢，换一张更清晰的试试？"
  - "小意外！文件格式不太对，支持PDF、JPG、PNG哦"
  - 配上可爱的表情符号和"再试一次"按钮

#### ✨ 微交互设计
- **悬停效果**：
  - 按钮悬停时轻微弹跳动画
  - 发票卡片悬停时轻微放大+阴影效果
  - 图标悬停时颜色渐变过渡
- **加载状态**：
  - "AI小助手正在认真识别中..."
  - 旋转的笑脸或可爱动物动画
  - "马上就好，请稍等一下下..."

#### 💡 智能鼓励系统
- **使用习惯鼓励**：
  - "连续7天使用，您真是个理财达人！"
  - "本周上传了5张发票，条理性满分！"
  - "您的分类准确率达到95%，AI都为您点赞！"

#### 🌟 个性化元素
- **用户称呼**：
  - "早上好，李老板！今天要处理什么发票呢？"
  - "欢迎回来，财务小能手！"
  - 根据时间显示不同问候语
- **智能赞美**：
  - "您的发票整理得井井有条！"
  - "数据准确率真高，专业！"
  - "您让繁琐的财务工作变得如此优雅！"

#### 🎨 视觉愉悦设计
- **渐变色彩**：
  - 统计卡片使用温暖的渐变色
  - 按钮使用柔和的彩色渐变
  - 图表使用明亮但不刺眼的颜色
- **可爱图标**：
  - 发票图标设计得更友好
  - 分类图标使用表情符号风格
  - 状态指示器使用笑脸/爱心等

#### 💬 情感化文案库
- **成功上传**：
  - "太棒了！又一张发票安全入库！"
  - "完美！您的效率让人佩服！"
  - "干得漂亮！财务管理就是这么简单！"
- **数据分析**：
  - "哇！您本月的支出控制得很好呢！"
  - "数据显示您是个很有条理的人！"
  - "您的财务状况一目了然，真棒！"
- **鼓励继续**：
  - "继续保持，您做得越来越好了！"
  - "每一张发票都让您离目标更近一步！"
  - "您的坚持让财务管理变得轻松愉快！"

## 🚀 技术实施要点

### 📱 性能优化
- **代码分割**：按页面和功能模块进行代码分割
- **图片优化**：使用Next.js Image组件优化发票图片加载
- **缓存策略**：合理使用浏览器缓存和服务端缓存

### 🔒 安全考虑
- **文件安全**：严格验证上传文件类型和大小
- **数据加密**：敏感信息在传输和存储时加密
- **权限控制**：严格的用户权限和数据访问控制
- **合规存储**：AWS S3澳洲区域存储，确保数据主权和7年保存期限
- **自动清理**：OpenAI临时文件处理完成后立即删除，最小化隐私风险

### 🔧 可扩展性设计
- **模块化架构**：为未来的税务计算和申报功能预留接口
- **API设计**：RESTful API设计，便于第三方集成
- **数据模型**：灵活的数据库设计，支持未来功能扩展

## 📈 未来扩展规划

### 🎯 第二阶段：税务计算模块
- 自动税务计算功能
- 税务规则引擎
- 多地区税法支持

### 🎯 第三阶段：税务申报模块
- 电子申报功能
- 税务表格自动填写
- 政府接口集成

### 🎯 第四阶段：高级功能
- 预算管理和预测
- 财务报表生成
- 审计追踪功能

---

*本PRD文档将随着项目进展持续更新和完善* ✨ 